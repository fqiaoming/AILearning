![AIä»£ç åŠ©æ‰‹æ¶æ„](./images/code_assistant.svg)
*å›¾ï¼šAIä»£ç åŠ©æ‰‹æ¶æ„*

# ç¬¬124è¯¾ï¼šAIä»£ç åŠ©æ‰‹ - VSCodeæ’ä»¶å¼€å‘

> **æœ¬è¯¾ç›®æ ‡**ï¼šå¼€å‘å®Œæ•´çš„VSCodeæ’ä»¶ï¼Œå®ç°IDEé›†æˆ
> 
> **æ ¸å¿ƒæŠ€èƒ½**ï¼šæ’ä»¶æ¶æ„ã€LSPåè®®ã€UIå¼€å‘ã€è°ƒè¯•æŠ€å·§
> 
> **å­¦ä¹ æ—¶é•¿**ï¼š90åˆ†é’Ÿ

---

## ğŸ“– å£æ’­æ–‡æ¡ˆï¼ˆ8åˆ†é’Ÿï¼‰
![Code Gen](./images/code_gen.svg)
*å›¾ï¼šCode Gen*


### ğŸ¯ å‰è¨€

"å‰é¢å®Œæˆäº†AIæ ¸å¿ƒåŠŸèƒ½ï¼Œä»Šå¤©è¦**æ‰“é€šæœ€åä¸€å…¬é‡Œ**ï¼

**æŠŠAIèƒ½åŠ›é›†æˆåˆ°VSCodeï¼**

**ä¸ºä»€ä¹ˆé€‰VSCodeï¼Ÿ**

```
å¸‚åœºæ•°æ®ï¼š
â€¢ å¸‚åœºä»½é¢ï¼š>70%ï¼ˆå¼€å‘è€…å·¥å…·ï¼‰
â€¢ æœˆæ´»ç”¨æˆ·ï¼š2000ä¸‡+
â€¢ æ’ä»¶ç”Ÿæ€ï¼š40000+æ’ä»¶
â€¢ GitHubæ”¯æŒï¼šå®˜æ–¹èƒŒä¹¦

æŠ€æœ¯ä¼˜åŠ¿ï¼š
â€¢ ä¸°å¯Œçš„API
â€¢ å®Œå–„çš„æ–‡æ¡£
â€¢ æ´»è·ƒçš„ç¤¾åŒº
â€¢ æ˜“äºå¼€å‘

å•†ä¸šä»·å€¼ï¼š
â€¢ ç”¨æˆ·åŸºæ•°å¤§
â€¢ å˜ç°è·¯å¾„æ¸…æ™°
â€¢ å®¹æ˜“æ¨å¹¿

æœ€ä½³é€‰æ‹©ï¼
```

**VSCodeæ’ä»¶æ¶æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        VSCodeä¸»è¿›ç¨‹                  â”‚
â”‚  â€¢ çª—å£ç®¡ç†                          â”‚
â”‚  â€¢ æ’ä»¶åŠ è½½                          â”‚
â”‚  â€¢ é…ç½®ç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Extension Hostï¼ˆæ’ä»¶å®¿ä¸»ï¼‰      â”‚
â”‚  â€¢ è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹                    â”‚
â”‚  â€¢ ä¸é˜»å¡UI                          â”‚
â”‚  â€¢ æ²™ç®±éš”ç¦»                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆ‘ä»¬çš„æ’ä»¶                          â”‚
â”‚  â”œâ”€ extension.tsï¼ˆå…¥å£ï¼‰            â”‚
â”‚  â”œâ”€ CompletionProvider              â”‚
â”‚  â”œâ”€ CodeLensProvider                â”‚
â”‚  â”œâ”€ ChatPanel                       â”‚
â”‚  â””â”€ LanguageClientï¼ˆLSPå®¢æˆ·ç«¯ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“ LSPåè®®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Language Serverï¼ˆæˆ‘ä»¬çš„åç«¯ï¼‰    â”‚
â”‚  â€¢ Pythonå®ç°                        â”‚
â”‚  â€¢ AIæ¨ç†                            â”‚
â”‚  â€¢ RAGæ£€ç´¢                           â”‚
â”‚  â€¢ å·¥å…·è°ƒç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰åç«¯åˆ†ç¦»ï¼
```

**æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š**

```
1. ä»£ç è¡¥å…¨ï¼ˆInlineCompletionProviderï¼‰
   â€¢ ç›‘å¬æ‰“å­—äº‹ä»¶
   â€¢ æ”¶é›†ä¸Šä¸‹æ–‡
   â€¢ è°ƒç”¨åç«¯API
   â€¢ å±•ç¤ºå€™é€‰é¡¹
   â€¢ å»¶è¿Ÿ<300ms

2. èŠå¤©é¢æ¿ï¼ˆWebviewPanelï¼‰
   â€¢ è‡ªå®šä¹‰UIï¼ˆHTML/CSS/JSï¼‰
   â€¢ åŒå‘é€šä¿¡
   â€¢ Markdownæ¸²æŸ“
   â€¢ ä»£ç é«˜äº®

3. ä»£ç è¯Šæ–­ï¼ˆDiagnosticCollectionï¼‰
   â€¢ æ³¢æµªçº¿æ ‡è®°
   â€¢ Hoveræç¤º
   â€¢ Quick Fix
   â€¢ å®æ—¶æ›´æ–°

4. CodeLensï¼ˆæç¤ºä¿¡æ¯ï¼‰
   â€¢ è¡Œå†…æç¤º
   â€¢ å¯ç‚¹å‡»æ“ä½œ
   â€¢ åŠ¨æ€åˆ·æ–°

5. å‘½ä»¤ï¼ˆCommandsï¼‰
   â€¢ å¿«æ·é”®ç»‘å®š
   â€¢ ä¸Šä¸‹æ–‡èœå•
   â€¢ å‘½ä»¤é¢æ¿
```

**LSPåè®®çš„ä»·å€¼ï¼š**

```
Language Server Protocolï¼š
â€¢ å¾®è½¯å¼€å‘
â€¢ æ ‡å‡†åŒ–åè®®
â€¢ IDEæ— å…³

ä¼˜åŠ¿ï¼š
âœ“ å‰åç«¯åˆ†ç¦»ï¼ˆè¯­è¨€æ— å…³ï¼‰
âœ“ åè®®æ ‡å‡†ï¼ˆæ˜“äºå¯¹æ¥ï¼‰
âœ“ å¤ç”¨åç«¯ï¼ˆæ”¯æŒå¤šIDEï¼‰
âœ“ æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰¹å¤„ç†ã€å¢é‡ï¼‰

æ”¯æŒçš„IDEï¼š
â€¢ VSCode
â€¢ Vim/Neovim
â€¢ Emacs
â€¢ IntelliJ IDEA
â€¢ Sublime Text

ä¸€æ¬¡å¼€å‘ï¼Œåˆ°å¤„è¿è¡Œï¼
```

**ä»Šå¤©è¿™ä¸€è¯¾ï¼Œæˆ‘è¦å¸¦ä½ ï¼š**

**ç¬¬ä¸€éƒ¨åˆ†ï¼šæ’ä»¶è„šæ‰‹æ¶**
- é¡¹ç›®ç»“æ„
- é…ç½®æ–‡ä»¶
- å¼€å‘ç¯å¢ƒ

**ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°**
- ä»£ç è¡¥å…¨
- èŠå¤©é¢æ¿
- è¯Šæ–­ç³»ç»Ÿ

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šLSPé›†æˆ**
- å®¢æˆ·ç«¯å®ç°
- æœåŠ¡ç«¯å®ç°
- åè®®é€šä¿¡

**ç¬¬å››éƒ¨åˆ†ï¼šè°ƒè¯•ä¸æµ‹è¯•**
- æœ¬åœ°è°ƒè¯•
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•

ä»0åˆ°1å¼€å‘æ’ä»¶ï¼"

---

## ğŸ“š ç¬¬ä¸€éƒ¨åˆ†ï¼šVSCodeæ’ä»¶è„šæ‰‹æ¶

### ä¸€ã€é¡¹ç›®ç»“æ„

```bash
# åˆ›å»ºé¡¹ç›®
npm install -g yo generator-code
yo code

# é¡¹ç›®ç»“æ„
ai-code-assistant/
â”œâ”€â”€ .vscode/
â”‚   â”œâ”€â”€ launch.json          # è°ƒè¯•é…ç½®
â”‚   â””â”€â”€ tasks.json           # ä»»åŠ¡é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts         # æ’ä»¶å…¥å£
â”‚   â”œâ”€â”€ completion/
â”‚   â”‚   â””â”€â”€ provider.ts      # è¡¥å…¨Provider
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ panel.ts         # èŠå¤©é¢æ¿
â”‚   â”‚   â””â”€â”€ webview.html     # UIé¡µé¢
â”‚   â”œâ”€â”€ diagnostics/
â”‚   â”‚   â””â”€â”€ provider.ts      # è¯Šæ–­Provider
â”‚   â”œâ”€â”€ lsp/
â”‚   â”‚   â””â”€â”€ client.ts        # LSPå®¢æˆ·ç«¯
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api.ts           # APIå°è£…
â”œâ”€â”€ server/                  # Language Server
â”‚   â”œâ”€â”€ main.py              # æœåŠ¡ç«¯å…¥å£
â”‚   â”œâ”€â”€ completion.py        # è¡¥å…¨é€»è¾‘
â”‚   â”œâ”€â”€ chat.py              # å¯¹è¯é€»è¾‘
â”‚   â””â”€â”€ diagnostics.py       # è¯Šæ–­é€»è¾‘
â”œâ”€â”€ package.json             # æ’ä»¶é…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScripté…ç½®
â””â”€â”€ README.md
```

### äºŒã€package.jsoné…ç½®

```json
{
  "name": "ai-code-assistant",
  "displayName": "AI Code Assistant",
  "description": "Intelligent code completion and analysis",
  "version": "0.1.0",
  "publisher": "your-name",
  "engines": {
    "vscode": "^1.75.0"
  },
  "categories": [
    "Programming Languages",
    "Machine Learning"
  ],
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "ai-assistant.chat",
        "title": "Open AI Chat",
        "icon": "$(comment-discussion)"
      },
      {
        "command": "ai-assistant.explain",
        "title": "Explain Code"
      },
      {
        "command": "ai-assistant.review",
        "title": "Review Code"
      }
    ],
    "keybindings": [
      {
        "command": "ai-assistant.chat",
        "key": "ctrl+shift+a",
        "mac": "cmd+shift+a"
      }
    ],
    "menus": {
      "editor/context": [
        {
          "command": "ai-assistant.explain",
          "when": "editorHasSelection",
          "group": "ai-assistant"
        },
        {
          "command": "ai-assistant.review",
          "group": "ai-assistant"
        }
      ]
    },
    "configuration": {
      "title": "AI Code Assistant",
      "properties": {
        "aiAssistant.apiUrl": {
          "type": "string",
          "default": "http://localhost:8000",
          "description": "API server URL"
        },
        "aiAssistant.autoComplete": {
          "type": "boolean",
          "default": true,
          "description": "Enable auto completion"
        },
        "aiAssistant.completionDelay": {
          "type": "number",
          "default": 300,
          "description": "Completion delay (ms)"
        }
      }
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "test": "npm run compile && node ./out/test/runTest.js"
  },
  "devDependencies": {
    "@types/vscode": "^1.75.0",
    "@types/node": "^18.0.0",
    "typescript": "^4.9.0"
  },
  "dependencies": {
    "axios": "^1.4.0",
    "vscode-languageclient": "^8.1.0"
  }
}
```

---

## ğŸ’» ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°

### ä¸€ã€æ’ä»¶å…¥å£ï¼ˆextension.tsï¼‰

```typescript
import * as vscode from 'vscode';
import { CompletionProvider } from './completion/provider';
import { ChatPanel } from './chat/panel';
import { DiagnosticsProvider } from './diagnostics/provider';
import { LanguageClient } from './lsp/client';

export function activate(context: vscode.ExtensionContext) {
    console.log('AI Code Assistantæ¿€æ´»');
    
    // 1. å¯åŠ¨Language Server
    const languageClient = new LanguageClient(context);
    languageClient.start();
    
    // 2. æ³¨å†Œä»£ç è¡¥å…¨
    const completionProvider = new CompletionProvider();
    context.subscriptions.push(
        vscode.languages.registerInlineCompletionItemProvider(
            { pattern: '**/*.{py,js,ts,java}' },
            completionProvider
        )
    );
    
    // 3. æ³¨å†Œè¯Šæ–­
    const diagnosticsProvider = new DiagnosticsProvider();
    context.subscriptions.push(diagnosticsProvider);
    
    // 4. æ³¨å†Œå‘½ä»¤
    
    // æ‰“å¼€èŠå¤©é¢æ¿
    context.subscriptions.push(
        vscode.commands.registerCommand('ai-assistant.chat', () => {
            ChatPanel.createOrShow(context.extensionUri);
        })
    );
    
    // è§£é‡Šä»£ç 
    context.subscriptions.push(
        vscode.commands.registerCommand('ai-assistant.explain', async () => {
            const editor = vscode.window.activeTextEditor;
            if (!editor) {
                return;
            }
            
            const selection = editor.selection;
            const selectedCode = editor.document.getText(selection);
            
            if (!selectedCode) {
                vscode.window.showWarningMessage('è¯·å…ˆé€‰ä¸­ä»£ç ');
                return;
            }
            
            // æ‰“å¼€èŠå¤©é¢æ¿å¹¶å‘é€è§£é‡Šè¯·æ±‚
            ChatPanel.createOrShow(context.extensionUri);
            ChatPanel.currentPanel?.explainCode(selectedCode);
        })
    );
    
    // ä»£ç å®¡æŸ¥
    context.subscriptions.push(
        vscode.commands.registerCommand('ai-assistant.review', async () => {
            const editor = vscode.window.activeTextEditor;
            if (!editor) {
                return;
            }
            
            const code = editor.document.getText();
            
            vscode.window.withProgress({
                location: vscode.ProgressLocation.Notification,
                title: "æ­£åœ¨å®¡æŸ¥ä»£ç ...",
                cancellable: false
            }, async (progress) => {
                // è°ƒç”¨å®¡æŸ¥API
                const result = await reviewCode(code);
                
                // æ˜¾ç¤ºç»“æœ
                vscode.window.showInformationMessage(
                    `ä»£ç å¾—åˆ†ï¼š${result.score}/100`
                );
                
                // æ›´æ–°è¯Šæ–­
                diagnosticsProvider.updateDiagnostics(
                    editor.document.uri,
                    result.issues
                );
            });
        })
    );
    
    // 5. çŠ¶æ€æ 
    const statusBarItem = vscode.window.createStatusBarItem(
        vscode.StatusBarAlignment.Right,
        100
    );
    statusBarItem.text = "$(rocket) AIåŠ©æ‰‹";
    statusBarItem.command = 'ai-assistant.chat';
    statusBarItem.show();
    context.subscriptions.push(statusBarItem);
    
    console.log('AI Code Assistantå·²å°±ç»ª');
}

export function deactivate() {
    console.log('AI Code Assistantåœç”¨');
}

// è¾…åŠ©å‡½æ•°
async function reviewCode(code: string) {
    // å®é™…ä¼šè°ƒç”¨API
    return {
        score: 85,
        issues: []
    };
}
```

### äºŒã€ä»£ç è¡¥å…¨Provider

```typescript
// src/completion/provider.ts
import * as vscode from 'vscode';
import axios from 'axios';

export class CompletionProvider implements vscode.InlineCompletionItemProvider {
    
    private cache: Map<string, vscode.InlineCompletionItem[]> = new Map();
    private debounceTimer?: NodeJS.Timeout;
    
    async provideInlineCompletionItems(
        document: vscode.TextDocument,
        position: vscode.Position,
        context: vscode.InlineCompletionContext,
        token: vscode.CancellationToken
    ): Promise<vscode.InlineCompletionItem[]> {
        
        // è·å–é…ç½®
        const config = vscode.workspace.getConfiguration('aiAssistant');
        const enabled = config.get<boolean>('autoComplete', true);
        
        if (!enabled) {
            return [];
        }
        
        // 1. æ”¶é›†ä¸Šä¸‹æ–‡
        const prefix = this.getPrefix(document, position);
        const suffix = this.getSuffix(document, position);
        
        // 2. æ£€æŸ¥ç¼“å­˜
        const cacheKey = this.getCacheKey(prefix, suffix);
        if (this.cache.has(cacheKey)) {
            console.log('ç¼“å­˜å‘½ä¸­');
            return this.cache.get(cacheKey)!;
        }
        
        // 3. é˜²æŠ–
        if (this.debounceTimer) {
            clearTimeout(this.debounceTimer);
        }
        
        return new Promise((resolve) => {
            this.debounceTimer = setTimeout(async () => {
                try {
                    // 4. è°ƒç”¨API
                    const completions = await this.fetchCompletions(
                        prefix,
                        suffix,
                        document.languageId
                    );
                    
                    // 5. è½¬æ¢ä¸ºVSCodeæ ¼å¼
                    const items = completions.map(c => 
                        new vscode.InlineCompletionItem(c.text)
                    );
                    
                    // 6. ç¼“å­˜
                    this.cache.set(cacheKey, items);
                    
                    resolve(items);
                } catch (error) {
                    console.error('è¡¥å…¨å¤±è´¥ï¼š', error);
                    resolve([]);
                }
            }, config.get<number>('completionDelay', 300));
        });
    }
    
    private getPrefix(document: vscode.TextDocument, position: vscode.Position): string {
        // è·å–å…‰æ ‡å‰çš„ä»£ç ï¼ˆæœ€å¤š2000ä¸ªå­—ç¬¦ï¼‰
        const start = new vscode.Position(Math.max(0, position.line - 50), 0);
        const range = new vscode.Range(start, position);
        let prefix = document.getText(range);
        
        // æˆªæ–­
        if (prefix.length > 2000) {
            prefix = prefix.substring(prefix.length - 2000);
        }
        
        return prefix;
    }
    
    private getSuffix(document: vscode.TextDocument, position: vscode.Position): string {
        // è·å–å…‰æ ‡åçš„ä»£ç ï¼ˆæœ€å¤š500ä¸ªå­—ç¬¦ï¼‰
        const end = new vscode.Position(
            Math.min(document.lineCount - 1, position.line + 20),
            Number.MAX_VALUE
        );
        const range = new vscode.Range(position, end);
        let suffix = document.getText(range);
        
        // æˆªæ–­
        if (suffix.length > 500) {
            suffix = suffix.substring(0, 500);
        }
        
        return suffix;
    }
    
    private getCacheKey(prefix: string, suffix: string): string {
        // ç®€å•hash
        return `${prefix.substring(prefix.length - 100)}-${suffix.substring(0, 100)}`;
    }
    
    private async fetchCompletions(
        prefix: string,
        suffix: string,
        language: string
    ): Promise<Array<{text: string, score: number}>> {
        
        const config = vscode.workspace.getConfiguration('aiAssistant');
        const apiUrl = config.get<string>('apiUrl', 'http://localhost:8000');
        
        try {
            const response = await axios.post(
                `${apiUrl}/completion`,
                {
                    prefix,
                    suffix,
                    language
                },
                {
                    timeout: 5000
                }
            );
            
            return response.data.completions || [];
        } catch (error) {
            console.error('APIè°ƒç”¨å¤±è´¥ï¼š', error);
            return [];
        }
    }
}
```

### ä¸‰ã€èŠå¤©é¢æ¿

```typescript
// src/chat/panel.ts
import * as vscode from 'vscode';
import axios from 'axios';

export class ChatPanel {
    public static currentPanel: ChatPanel | undefined;
    
    private readonly _panel: vscode.WebviewPanel;
    private readonly _extensionUri: vscode.Uri;
    private _disposables: vscode.Disposable[] = [];
    
    public static createOrShow(extensionUri: vscode.Uri) {
        const column = vscode.window.activeTextEditor
            ? vscode.window.activeTextEditor.viewColumn
            : undefined;
        
        // å¦‚æœå·²å­˜åœ¨ï¼Œæ˜¾ç¤º
        if (ChatPanel.currentPanel) {
            ChatPanel.currentPanel._panel.reveal(column);
            return;
        }
        
        // åˆ›å»ºæ–°é¢æ¿
        const panel = vscode.window.createWebviewPanel(
            'aiChat',
            'AI Chat',
            column || vscode.ViewColumn.One,
            {
                enableScripts: true,
                retainContextWhenHidden: true,
                localResourceRoots: [extensionUri]
            }
        );
        
        ChatPanel.currentPanel = new ChatPanel(panel, extensionUri);
    }
    
    private constructor(panel: vscode.WebviewPanel, extensionUri: vscode.Uri) {
        this._panel = panel;
        this._extensionUri = extensionUri;
        
        // è®¾ç½®HTML
        this._panel.webview.html = this._getHtmlForWebview();
        
        // ç›‘å¬æ¶ˆæ¯
        this._panel.webview.onDidReceiveMessage(
            async message => {
                switch (message.type) {
                    case 'chat':
                        await this._handleChat(message.text);
                        break;
                    case 'explain':
                        await this._handleExplain(message.code);
                        break;
                }
            },
            null,
            this._disposables
        );
        
        // æ¸…ç†
        this._panel.onDidDispose(() => this.dispose(), null, this._disposables);
    }
    
    public explainCode(code: string) {
        this._panel.webview.postMessage({
            type: 'insertCode',
            code: code
        });
    }
    
    private async _handleChat(text: string) {
        // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        this._panel.webview.postMessage({
            type: 'message',
            role: 'user',
            content: text
        });
        
        // è°ƒç”¨API
        try {
            const config = vscode.workspace.getConfiguration('aiAssistant');
            const apiUrl = config.get<string>('apiUrl', 'http://localhost:8000');
            
            const response = await axios.post(`${apiUrl}/chat`, {
                message: text
            });
            
            // æ˜¾ç¤ºAIå›å¤
            this._panel.webview.postMessage({
                type: 'message',
                role: 'assistant',
                content: response.data.reply
            });
        } catch (error) {
            vscode.window.showErrorMessage('Chatè¯·æ±‚å¤±è´¥');
        }
    }
    
    private async _handleExplain(code: string) {
        // ç±»ä¼¼chat
        await this._handleChat(`è¯·è§£é‡Šä»¥ä¸‹ä»£ç ï¼š\n\`\`\`\n${code}\n\`\`\``);
    }
    
    private _getHtmlForWebview(): string {
        return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat</title>
    <style>
        body {
            padding: 10px;
            color: var(--vscode-foreground);
            background-color: var(--vscode-editor-background);
        }
        #messages {
            height: calc(100vh - 100px);
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .user {
            background-color: var(--vscode-input-background);
            text-align: right;
        }
        .assistant {
            background-color: var(--vscode-editor-inactiveSelectionBackground);
        }
        #input-container {
            display: flex;
            gap: 10px;
        }
        #input {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--vscode-input-border);
            background-color: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
        }
        button {
            padding: 8px 16px;
            background-color: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: var(--vscode-button-hoverBackground);
        }
    </style>
</head>
<body>
    <div id="messages"></div>
    <div id="input-container">
        <input type="text" id="input" placeholder="è¾“å…¥æ¶ˆæ¯...">
        <button onclick="send()">å‘é€</button>
    </div>
    
    <script>
        const vscode = acquireVsCodeApi();
        
        function send() {
            const input = document.getElementById('input');
            const text = input.value.trim();
            if (!text) return;
            
            vscode.postMessage({
                type: 'chat',
                text: text
            });
            
            input.value = '';
        }
        
        // ç›‘å¬Enteré”®
        document.getElementById('input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                send();
            }
        });
        
        // æ¥æ”¶æ¶ˆæ¯
        window.addEventListener('message', event => {
            const message = event.data;
            
            if (message.type === 'message') {
                addMessage(message.role, message.content);
            } else if (message.type === 'insertCode') {
                document.getElementById('input').value = 
                    \`è¯·è§£é‡Šä»¥ä¸‹ä»£ç ï¼š\\n\\\`\\\`\\\`\\n\${message.code}\\n\\\`\\\`\\\`\`;
            }
        });
        
        function addMessage(role, content) {
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = \`message \${role}\`;
            div.textContent = content;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>`;
    }
    
    public dispose() {
        ChatPanel.currentPanel = undefined;
        
        this._panel.dispose();
        
        while (this._disposables.length) {
            const disposable = this._disposables.pop();
            if (disposable) {
                disposable.dispose();
            }
        }
    }
}
```

---

## ğŸ“ è¯¾åæ€»ç»“

### æ ¸å¿ƒæ”¶è·

1. **VSCodeæ’ä»¶å¼€å‘**
   - é¡¹ç›®ç»“æ„
   - é…ç½®æ–‡ä»¶
   - APIä½¿ç”¨

2. **æ ¸å¿ƒåŠŸèƒ½å®ç°**
   - ä»£ç è¡¥å…¨
   - èŠå¤©é¢æ¿
   - è¯Šæ–­ç³»ç»Ÿ

3. **ç”¨æˆ·ä½“éªŒ**
   - æ€§èƒ½ä¼˜åŒ–
   - UIè®¾è®¡
   - äº¤äº’æµç•…

---

## ğŸš€ ä¸‹èŠ‚é¢„å‘Š

ä¸‹ä¸€è¯¾ï¼š**ç¬¬125è¯¾ï¼šAIä»£ç åŠ©æ‰‹ - æµ‹è¯•ä¸å‘å¸ƒ**

- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- æ‰“åŒ…å‘å¸ƒ
- å¸‚åœºæ¨å¹¿

**å®Œæ•´äº¤ä»˜äº§å“ï¼** ğŸ”¥

---

**ğŸ’ª æ’ä»¶å¼€å‘å®Œæˆï¼å‡†å¤‡å‘å¸ƒï¼**

**ä¸‹ä¸€è¯¾è§ï¼** ğŸ‰
