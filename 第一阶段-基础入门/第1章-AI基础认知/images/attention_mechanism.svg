<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 450" width="700" height="450">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64b5f6"/>
    </marker>
    <linearGradient id="qGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ff6b6b"/>
      <stop offset="100%" style="stop-color:#ee5a5a"/>
    </linearGradient>
    <linearGradient id="kGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4ecdc4"/>
      <stop offset="100%" style="stop-color:#26a69a"/>
    </linearGradient>
    <linearGradient id="vGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ffd93d"/>
      <stop offset="100%" style="stop-color:#f9ca24"/>
    </linearGradient>
  </defs>
  
  <!-- 背景 -->
  <rect width="700" height="450" fill="#0f0f23"/>
  
  <!-- 标题 -->
  <text x="350" y="35" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="22" font-weight="bold">Self-Attention 机制详解</text>
  
  <!-- 输入层 -->
  <text x="70" y="85" text-anchor="middle" fill="#81c784" font-family="Arial, sans-serif" font-size="14" font-weight="bold">输入嵌入</text>
  <rect x="30" y="95" width="80" height="60" rx="8" fill="#2d3436"/>
  <text x="70" y="115" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12">X₁</text>
  <text x="70" y="135" text-anchor="middle" fill="#a0a0a0" font-family="Arial, sans-serif" font-size="10">[d_model]</text>
  
  <rect x="30" y="165" width="80" height="60" rx="8" fill="#2d3436"/>
  <text x="70" y="185" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12">X₂</text>
  <text x="70" y="205" text-anchor="middle" fill="#a0a0a0" font-family="Arial, sans-serif" font-size="10">[d_model]</text>
  
  <rect x="30" y="235" width="80" height="60" rx="8" fill="#2d3436"/>
  <text x="70" y="255" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12">X₃</text>
  <text x="70" y="275" text-anchor="middle" fill="#a0a0a0" font-family="Arial, sans-serif" font-size="10">[d_model]</text>
  
  <!-- 箭头连接输入到QKV -->
  <line x1="110" y1="125" x2="155" y2="125" stroke="#64b5f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="110" y1="195" x2="155" y2="195" stroke="#64b5f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="110" y1="265" x2="155" y2="265" stroke="#64b5f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Q K V 层 -->
  <text x="230" y="85" text-anchor="middle" fill="#ff6b6b" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Query (Q)</text>
  <rect x="165" y="100" width="55" height="40" rx="5" fill="url(#qGrad)"/>
  <text x="192" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">Q₁</text>
  <rect x="165" y="175" width="55" height="40" rx="5" fill="url(#qGrad)"/>
  <text x="192" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">Q₂</text>
  <rect x="165" y="250" width="55" height="40" rx="5" fill="url(#qGrad)"/>
  <text x="192" y="275" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">Q₃</text>
  
  <text x="295" y="85" text-anchor="middle" fill="#4ecdc4" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Key (K)</text>
  <rect x="230" y="100" width="55" height="40" rx="5" fill="url(#kGrad)"/>
  <text x="257" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">K₁</text>
  <rect x="230" y="175" width="55" height="40" rx="5" fill="url(#kGrad)"/>
  <text x="257" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">K₂</text>
  <rect x="230" y="250" width="55" height="40" rx="5" fill="url(#kGrad)"/>
  <text x="257" y="275" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11">K₃</text>
  
  <text x="360" y="85" text-anchor="middle" fill="#ffd93d" font-family="Arial, sans-serif" font-size="14" font-weight="bold">Value (V)</text>
  <rect x="295" y="100" width="55" height="40" rx="5" fill="url(#vGrad)"/>
  <text x="322" y="125" text-anchor="middle" fill="#333" font-family="Arial, sans-serif" font-size="11">V₁</text>
  <rect x="295" y="175" width="55" height="40" rx="5" fill="url(#vGrad)"/>
  <text x="322" y="200" text-anchor="middle" fill="#333" font-family="Arial, sans-serif" font-size="11">V₂</text>
  <rect x="295" y="250" width="55" height="40" rx="5" fill="url(#vGrad)"/>
  <text x="322" y="275" text-anchor="middle" fill="#333" font-family="Arial, sans-serif" font-size="11">V₃</text>
  
  <!-- 注意力计算 -->
  <rect x="390" y="130" width="120" height="130" rx="10" fill="#1e3a5f" stroke="#64b5f6" stroke-width="2"/>
  <text x="450" y="155" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Attention</text>
  <text x="450" y="175" text-anchor="middle" fill="#64b5f6" font-family="Arial, sans-serif" font-size="11">Score = Q·Kᵀ</text>
  <text x="450" y="195" text-anchor="middle" fill="#64b5f6" font-family="Arial, sans-serif" font-size="11">÷ √d_k</text>
  <text x="450" y="220" text-anchor="middle" fill="#81c784" font-family="Arial, sans-serif" font-size="11">↓ Softmax</text>
  <text x="450" y="245" text-anchor="middle" fill="#ffd93d" font-family="Arial, sans-serif" font-size="11">× V</text>
  
  <!-- 箭头从QKV到Attention -->
  <line x1="220" y1="150" x2="390" y2="175" stroke="#ff6b6b" stroke-width="2"/>
  <line x1="285" y1="150" x2="390" y2="180" stroke="#4ecdc4" stroke-width="2"/>
  <line x1="350" y1="195" x2="390" y2="195" stroke="#ffd93d" stroke-width="2"/>
  
  <!-- 输出 -->
  <text x="580" y="160" text-anchor="middle" fill="#81c784" font-family="Arial, sans-serif" font-size="14" font-weight="bold">输出</text>
  <line x1="510" y1="195" x2="550" y2="195" stroke="#64b5f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="560" y="170" width="80" height="50" rx="8" fill="#2d3436" stroke="#81c784" stroke-width="2"/>
  <text x="600" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="12">Z</text>
  
  <!-- 公式区域 -->
  <rect x="30" y="330" width="640" height="100" rx="10" fill="#1a1a2e"/>
  <text x="350" y="360" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="16" font-weight="bold">Self-Attention 计算公式</text>
  <text x="350" y="395" text-anchor="middle" fill="#64b5f6" font-family="Courier New, monospace" font-size="18">Attention(Q, K, V) = softmax(QK^T / √d_k) × V</text>
  <text x="350" y="420" text-anchor="middle" fill="#a0a0a0" font-family="Arial, sans-serif" font-size="12">其中 d_k 是Key向量的维度，用于缩放防止梯度消失</text>
</svg>

