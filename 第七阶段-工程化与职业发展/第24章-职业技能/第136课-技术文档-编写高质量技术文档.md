![职业技能体系](./images/skills.svg)
*图：职业技能体系*

# 第136课：技术文档 - 编写高质量技术文档

> **本课目标**：掌握技术文档编写方法，提升协作效率
> 
> **核心技能**：文档类型、编写规范、Markdown技巧、API文档
> 
> **学习时长**：90分钟

---

## 📖 口播文案（8分钟）

### 🎯 前言

"代码写完了，文档呢？**没有！**

**无文档=无法维护！**

**缺少文档的代价：**

```
场景1：新人入职
• 代码没注释
• 没有文档
• 问题无处查
• 只能问老员工
• 老员工被打断
• 效率低下

结果：新人痛苦，老员工更痛苦

场景2：系统故障
• 半夜报警
• 不知道怎么回滚
• 找不到部署文档
• 紧张操作
• 误删数据库

结果：重大事故

场景3：接手项目
• 原作者离职
• 代码无文档
• 看不懂逻辑
• 不敢改代码
• 技术债累积

结果：系统腐化

场景4：对外API
• 没有API文档
• 用户不会用
• 客服问题暴增
• 用户流失

结果：产品失败

文档是生产力！
```

**好文档 vs 差文档：**

```
【差文档】

"这个函数用来处理数据"

问题：
✗ 什么数据？
✗ 怎么处理？
✗ 返回什么？
✗ 有什么限制？

等于没说！

【好文档】

"""
处理用户上传的CSV文件

功能：
1. 验证CSV格式
2. 清洗数据（去除空行、重复行）
3. 转换为DataFrame

参数：
- file_path (str): CSV文件路径
- encoding (str): 文件编码，默认'utf-8'
- max_rows (int): 最大行数，默认10000

返回：
- pd.DataFrame: 清洗后的数据
- None: 如果文件格式错误

异常：
- FileNotFoundError: 文件不存在
- ValueError: 文件格式错误或超过行数限制

示例：
```python
df = process_csv_file('data.csv')
if df is not None:
    print(f"成功处理{len(df)}行数据")
```

注意事项：
• 文件大小不能超过100MB
• 必须包含表头
• 日期格式必须是YYYY-MM-DD
"""

清晰明了！
```

**技术文档的5大类型：**

```
类型1：README（项目说明）
• 项目是什么
• 如何安装
• 如何使用
• 快速开始

必备！

类型2：API文档
• 接口列表
• 参数说明
• 返回值
• 错误码
• 示例代码

对外必备！

类型3：设计文档
• 架构设计
• 数据库设计
• 接口设计
• 技术选型

团队必备！

类型4：运维文档
• 部署流程
• 配置说明
• 故障排查
• 应急预案

生产必备！

类型5：开发指南
• 环境搭建
• 编码规范
• Git流程
• 测试指南

新人必备！
```

**优秀README的结构：**

```markdown
# 项目名称

一句话描述项目

## 特性

• 特性1
• 特性2
• 特性3

## 快速开始

### 安装

```bash
pip install package-name
```

### 使用

```python
from package import feature
result = feature.do_something()
```

## 完整文档

[查看文档](https://docs.example.com)

## 贡献指南

欢迎贡献！请阅读[贡献指南](CONTRIBUTING.md)

## License

MIT

---

核心原则：
1. 用户5分钟内能跑起来
2. 从简单到复杂
3. 代码可复制粘贴
4. 有效果截图
```

**API文档的标准格式：**

```
【接口】
POST /api/v1/predict

【描述】
AI文本预测接口

【请求头】
Authorization: Bearer <token>
Content-Type: application/json

【请求体】
{
  "text": "要预测的文本",
  "model": "gpt-4",  // 可选，默认gpt-3.5
  "temperature": 0.7  // 可选，默认0.7
}

【响应】
成功（200）：
{
  "result": "预测结果",
  "confidence": 0.95,
  "tokens_used": 150
}

失败（400）：
{
  "error": "文本不能为空",
  "code": "INVALID_INPUT"
}

失败（401）：
{
  "error": "认证失败",
  "code": "UNAUTHORIZED"
}

【错误码】
• INVALID_INPUT: 输入参数错误
• UNAUTHORIZED: 认证失败
• RATE_LIMIT: 超过调用限制
• SERVER_ERROR: 服务器错误

【示例】

cURL:
```bash
curl -X POST https://api.example.com/v1/predict \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"text": "测试文本"}'
```

Python:
```python
import requests

response = requests.post(
    "https://api.example.com/v1/predict",
    headers={"Authorization": "Bearer YOUR_TOKEN"},
    json={"text": "测试文本"}
)
print(response.json())
```

【限流】
• 免费版：100次/天
• 付费版：10000次/天

【注意事项】
• Token请妥善保管
• 文本长度不超过10000字符
• 支持UTF-8编码
```

**今天这一课，我要带你：**

**第一部分：文档规范**
- README编写
- 注释规范
- 文档结构

**第二部分：API文档**
- OpenAPI规范
- Swagger使用
- 自动生成

**第三部分：设计文档**
- 架构文档
- 数据库设计
- 接口设计

**第四部分：Markdown技巧**
- 高级语法
- 图表绘制
- 工具推荐

写出好文档！"

---

## 📚 第一部分：优秀README编写

### 一、README模板

```markdown
# AI RAG系统

<p align="center">
  <img src="https://img.shields.io/badge/Python-3.9+-blue.svg" alt="Python">
  <img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License">
  <img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg" alt="PRs">
</p>

基于LangChain和OpenAI的企业级RAG（检索增强生成）系统，帮助企业快速构建智能问答应用。

## ✨ 特性

- 🚀 **开箱即用**：5分钟快速启动
- 📚 **多格式支持**：支持PDF、Word、Markdown等多种文档格式
- 🔍 **智能检索**：混合检索+重排序，准确率>95%
- 💬 **流式响应**：支持流式输出，用户体验佳
- 🔒 **企业级**：完整的认证、限流、监控体系
- 🎯 **高性能**：支持1000+ QPS，P95<2s

## 📦 安装

### 环境要求

- Python 3.9+
- 2GB+ 内存
- Redis（可选，用于缓存）

### 快速安装

```bash
# 克隆仓库
git clone https://github.com/yourname/ai-rag-system.git
cd ai-rag-system

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑.env，填入你的API密钥
```

## 🚀 快速开始


![技术文档](./images/documentation.svg)
*图：技术文档*

### 1. 启动服务

```bash
python main.py
```

服务将在 http://localhost:8000 启动

### 2. 上传文档

```bash
curl -X POST http://localhost:8000/api/v1/documents/upload \
  -F "file=@your_document.pdf"
```

### 3. 开始问答

```bash
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"question": "这个文档讲了什么？"}'
```

### 4. 使用Python SDK

```python
from ai_rag import RAGClient

# 初始化客户端
client = RAGClient(api_key="your_api_key")

# 上传文档
client.upload_document("document.pdf")

# 提问
response = client.ask("这个文档讲了什么？")
print(response.answer)
```

## 📖 完整文档

- [📘 用户指南](docs/user-guide.md)
- [🔧 开发指南](docs/development.md)
- [🚀 部署指南](docs/deployment.md)
- [📚 API文档](docs/api.md)
- [❓ FAQ](docs/faq.md)

## 🏗️ 架构

```
┌─────────────┐
│  Web前端    │
└──────┬──────┘
       │
┌──────▼──────┐     ┌─────────────┐
│  FastAPI    │────▶│  LangChain  │
└──────┬──────┘     └──────┬──────┘
       │                   │
┌──────▼──────┐     ┌──────▼──────┐
│   Redis     │     │   Milvus    │
└─────────────┘     └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │  OpenAI API │
                    └─────────────┘
```

## 🔧 配置

### 基础配置

```python
# config.py
RAG_CONFIG = {
    # LLM配置
    "llm_model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 2000,
    
    # 检索配置
    "top_k": 5,
    "similarity_threshold": 0.7,
    
    # 向量库配置
    "vector_db": "milvus",
    "collection_name": "documents",
}
```

### 高级配置

查看 [配置指南](docs/configuration.md)

## 📊 性能

| 指标 | 数值 |
|------|------|
| 响应时间（P95） | <2s |
| 吞吐量 | 1000+ QPS |
| 准确率 | >95% |
| 可用性 | 99.9% |

## 🧪 测试

```bash
# 运行测试
pytest

# 覆盖率报告
pytest --cov=app --cov-report=html
```

## 🤝 贡献

欢迎贡献！请查看 [贡献指南](CONTRIBUTING.md)

1. Fork本仓库
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的改动 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个Pull Request

## 📝 更新日志

查看 [CHANGELOG.md](CHANGELOG.md)

## 📄 License

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 🙏 致谢

- [LangChain](https://github.com/langchain-ai/langchain)
- [OpenAI](https://openai.com/)
- [Milvus](https://milvus.io/)

## 📧 联系方式

- 作者：Your Name
- Email: your.email@example.com
- 项目链接：https://github.com/yourname/ai-rag-system

---

**如果这个项目对你有帮助，请给个⭐️吧！**
```

---

## 💻 第二部分：API文档自动生成

### 一、使用FastAPI自动生成

```python
# app/main.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel, Field
from typing import Optional, List

app = FastAPI(
    title="AI RAG API",
    description="企业级RAG系统API",
    version="1.0.0",
    docs_url="/docs",  # Swagger UI
    redoc_url="/redoc",  # ReDoc
)

class PredictRequest(BaseModel):
    """预测请求"""
    
    text: str = Field(
        ...,
        description="输入文本",
        min_length=1,
        max_length=10000,
        example="这是一段测试文本"
    )
    
    model: Optional[str] = Field(
        default="gpt-3.5-turbo",
        description="模型名称",
        example="gpt-3.5-turbo"
    )
    
    temperature: Optional[float] = Field(
        default=0.7,
        description="温度参数（0-1）",
        ge=0,
        le=1,
        example=0.7
    )
    
    class Config:
        schema_extra = {
            "example": {
                "text": "人工智能的未来发展趋势是什么？",
                "model": "gpt-4",
                "temperature": 0.7
            }
        }

class PredictResponse(BaseModel):
    """预测响应"""
    
    result: str = Field(
        ...,
        description="预测结果",
        example="AI的未来发展趋势包括..."
    )
    
    confidence: float = Field(
        ...,
        description="置信度（0-1）",
        ge=0,
        le=1,
        example=0.95
    )
    
    tokens_used: int = Field(
        ...,
        description="使用的token数",
        example=150
    )
    
    sources: Optional[List[str]] = Field(
        default=None,
        description="来源文档",
        example=["doc1.pdf", "doc2.pdf"]
    )

@app.post(
    "/api/v1/predict",
    response_model=PredictResponse,
    summary="AI预测接口",
    description="使用AI模型进行文本预测",
    responses={
        200: {
            "description": "预测成功",
            "content": {
                "application/json": {
                    "example": {
                        "result": "AI将在多个领域取得突破...",
                        "confidence": 0.95,
                        "tokens_used": 200,
                        "sources": ["doc1.pdf"]
                    }
                }
            }
        },
        400: {
            "description": "请求参数错误",
            "content": {
                "application/json": {
                    "example": {
                        "detail": "文本不能为空"
                    }
                }
            }
        },
        401: {
            "description": "认证失败"
        },
        429: {
            "description": "请求过于频繁"
        }
    },
    tags=["预测"]
)
async def predict(request: PredictRequest):
    """
    AI预测接口
    
    详细说明：
    - 支持多种模型选择
    - 支持温度参数调节
    - 返回置信度和来源
    
    限流：
    - 免费版：100次/天
    - 付费版：10000次/天
    
    注意事项：
    - 文本长度不超过10000字符
    - 建议温度参数0.5-0.9
    - Token费用单独计费
    """
    
    # 业务逻辑
    result = {
        "result": f"对'{request.text}'的预测结果...",
        "confidence": 0.95,
        "tokens_used": 150,
        "sources": ["doc1.pdf"]
    }
    
    return result

# 访问 http://localhost:8000/docs 查看自动生成的API文档
```

---

## 🎯 第三部分：设计文档模板

### 一、架构设计文档

```markdown
# RAG系统架构设计文档

## 1. 概述

### 1.1 背景
企业需要一个智能问答系统，基于内部文档提供准确回答。

### 1.2 目标
- 准确率>95%
- 响应时间<2s
- 支持1000+ QPS

## 2. 系统架构

### 2.1 整体架构

```
┌────────────────────────────────────────────────┐
│                   用户层                        │
│  Web界面  │  移动端  │  API调用                │
└───────────────┬────────────────────────────────┘
                │
┌───────────────▼────────────────────────────────┐
│                   接入层                        │
│  Nginx负载均衡  │  API网关  │  认证鉴权         │
└───────────────┬────────────────────────────────┘
                │
┌───────────────▼────────────────────────────────┐
│                   应用层                        │
│  FastAPI服务  │  RAG引擎  │  业务逻辑           │
└─────┬─────────┴──────────┬────────────────────┘
      │                    │
┌─────▼─────┐       ┌──────▼──────┐
│  缓存层   │       │   数据层     │
│  Redis    │       │  向量库      │
└───────────┘       │  Milvus      │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │   模型层      │
                    │  LLM API      │
                    └──────────────┘
```

### 2.2 模块划分

#### 2.2.1 文档处理模块
- 文档解析
- 文本分块
- 向量化

#### 2.2.2 检索模块
- 向量检索
- 混合检索
- 重排序

#### 2.2.3 生成模块
- Prompt构建
- LLM调用
- 结果处理

## 3. 技术选型

| 组件 | 技术 | 理由 |
|------|------|------|
| Web框架 | FastAPI | 高性能、异步、自动文档 |
| LLM | OpenAI GPT-4 | 准确率最高 |
| 向量库 | Milvus | 高性能、可扩展 |
| 缓存 | Redis | 成熟稳定 |
| 监控 | Prometheus | 标准方案 |

## 4. 数据流

### 4.1 文档上传流程

```
用户上传 → 格式验证 → 文本提取 → 分块 → 向量化 → 存储到Milvus
```

### 4.2 问答流程

```
用户提问 → 查询缓存 → 向量检索 → 重排序 → Prompt构建 → LLM生成 → 返回结果
```

## 5. 接口设计

### 5.1 核心接口

#### 文档上传
```
POST /api/v1/documents/upload
```

#### 问答
```
POST /api/v1/chat
```

详见：[API文档](api.md)

## 6. 数据库设计

### 6.1 文档表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | bigint | 主键 |
| title | varchar(200) | 标题 |
| content | text | 内容 |
| vector_ids | json | 向量ID列表 |
| created_at | datetime | 创建时间 |

## 7. 性能优化

### 7.1 缓存策略
- 热门问题缓存（Redis）
- 查询结果缓存（1小时）

### 7.2 并发优化
- 异步处理
- 连接池
- 限流

## 8. 安全设计

### 8.1 认证
- JWT Token

### 8.2 权限
- RBAC

### 8.3 限流
- 令牌桶算法

## 9. 监控告警

### 9.1 指标
- QPS
- 延迟（P50/P95/P99）
- 错误率

### 9.2 告警
- 延迟>2s
- 错误率>1%
- 服务宕机

## 10. 部署方案

### 10.1 容器化
- Docker
- Docker Compose

### 10.2 编排
- Kubernetes

### 10.3 CI/CD
- GitLab CI

## 附录

### A. 术语表
- **RAG**: Retrieval Augmented Generation
- **LLM**: Large Language Model
- **QPS**: Queries Per Second
```

---

## 📝 课后总结

### 核心收获

1. **文档类型**
   - README
   - API文档
   - 设计文档
   - 运维文档
   - 开发指南

2. **编写规范**
   - 结构清晰
   - 示例丰富
   - 及时更新

3. **自动化**
   - FastAPI自动生成
   - Swagger UI
   - 代码注释

4. **最佳实践**
   - 从用户视角
   - 简单到复杂
   - 可复制粘贴

---

## 🚀 下节预告

下一课：**第137课：Git协作 - 团队开发最佳实践**

- Git工作流
- 分支策略
- Code Review
- 冲突解决

**高效协作！** 🔥

---

**💪 技术文档能力提升！写出好文档！**

**下一课见！** 🎉
