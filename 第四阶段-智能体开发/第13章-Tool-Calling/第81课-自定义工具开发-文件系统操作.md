![Tool Callingæµç¨‹](./images/tool_calling.svg)
*å›¾ï¼šTool Callingæµç¨‹*

# ç¬¬81è¯¾ï¼šè‡ªå®šä¹‰å·¥å…·å¼€å‘-æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

> **æœ¬è¯¾ç›®æ ‡**ï¼šæŒæ¡æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·å¼€å‘ï¼Œè®©Agentèƒ½å¤Ÿè¯»å†™æ–‡ä»¶
> 
> **æ ¸å¿ƒæŠ€èƒ½**ï¼šæ–‡ä»¶è¯»å†™ã€ç›®å½•æ“ä½œã€å®‰å…¨æ²™ç®±ã€æ‰¹é‡å¤„ç†
> 
> **å®æˆ˜æ¡ˆä¾‹**ï¼šæ„å»ºæ–‡ä»¶ç®¡ç†Agent
> 
> **å­¦ä¹ æ—¶é•¿**ï¼š80åˆ†é’Ÿ

---

## ğŸ“– å£æ’­æ–‡æ¡ˆï¼ˆ5åˆ†é’Ÿï¼‰
![Tool Chain](./images/tool_chain.svg)
*å›¾ï¼šTool Chain*


### ğŸ¯ å‰è¨€

"ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†æ•°æ®åº“æ“ä½œã€‚

ä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ å¦ä¸€ä¸ªé‡è¦èƒ½åŠ›ï¼š**è®©Agentæ“ä½œæ–‡ä»¶ç³»ç»Ÿï¼**

**ä¸ºä»€ä¹ˆéœ€è¦æ–‡ä»¶æ“ä½œï¼Ÿ**

çœ‹å‡ ä¸ªçœŸå®åœºæ™¯ï¼š

**åœºæ™¯1ï¼šæ–‡æ¡£å¤„ç†åŠ©æ‰‹**
```
ç”¨æˆ·ï¼š"å¸®æˆ‘è¯»å–report.txtçš„å†…å®¹"

Agentï¼š
1. è¯»å–æ–‡ä»¶
2. åˆ†æå†…å®¹
3. ç”Ÿæˆæ‘˜è¦

â†’ "è¿™æ˜¯ä¸€ä»½å…³äºQ3å­£åº¦çš„é”€å”®æŠ¥å‘Š..."

âœ… æ™ºèƒ½ç†è§£ï¼
```

**åœºæ™¯2ï¼šæ—¥å¿—åˆ†æåŠ©æ‰‹**
```
ç”¨æˆ·ï¼š"åˆ†ææœ€è¿‘çš„é”™è¯¯æ—¥å¿—"

Agentï¼š
1. éå†logsç›®å½•
2. ç­›é€‰erroræ—¥å¿—
3. ç»Ÿè®¡åˆ†æ
4. ç”ŸæˆæŠ¥å‘Š

â†’ "å‘ç°23ä¸ªé”™è¯¯ï¼Œä¸»è¦é›†ä¸­åœ¨..."

âœ… è‡ªåŠ¨åˆ†æï¼
```

**åœºæ™¯3ï¼šæ‰¹é‡æ–‡ä»¶å¤„ç†**
```
ç”¨æˆ·ï¼š"æŠŠæ‰€æœ‰.txtæ–‡ä»¶è½¬æˆ.mdæ ¼å¼"

Agentï¼š
1. æ‰«æç›®å½•
2. è¯»å–æ¯ä¸ª.txt
3. è½¬æ¢æ ¼å¼
4. ä¿å­˜ä¸º.md

â†’ "å·²å¤„ç†128ä¸ªæ–‡ä»¶"

âœ… é«˜æ•ˆæ‰¹å¤„ç†ï¼
```

**æ–‡ä»¶æ“ä½œçš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š**

**æŒ‘æˆ˜1ï¼šè·¯å¾„å®‰å…¨**
```python
âŒ å±é™©ï¼š
file_path = user_input  # "/etc/passwd"
with open(file_path) as f:
    content = f.read()
# å¯èƒ½è¯»å–ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶ï¼

âœ… å®‰å…¨ï¼š
BASE_DIR = "/safe/workspace"
file_path = os.path.join(BASE_DIR, user_input)
# æ£€æŸ¥è·¯å¾„æ˜¯å¦åœ¨BASE_DIRå†…
if not file_path.startswith(BASE_DIR):
    raise SecurityError("è·¯å¾„ä¸å®‰å…¨ï¼")
```

**æŒ‘æˆ˜2ï¼šæ–‡ä»¶å¤§å°**
```python
âŒ å±é™©ï¼š
content = open('huge_file.txt').read()
# å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼

âœ… å®‰å…¨ï¼š
MAX_SIZE = 10 * 1024 * 1024  # 10MB
size = os.path.getsize('file.txt')
if size > MAX_SIZE:
    raise ValueError("æ–‡ä»¶è¿‡å¤§ï¼")
```

**æŒ‘æˆ˜3ï¼šç¼–ç é—®é¢˜**
```python
âŒ å¯èƒ½å‡ºé”™ï¼š
with open('file.txt') as f:
    content = f.read()
# å¯èƒ½é‡åˆ°ç¼–ç é”™è¯¯

âœ… å¥å£®ï¼š
with open('file.txt', encoding='utf-8', errors='ignore') as f:
    content = f.read()
```

**æŒ‘æˆ˜4ï¼šå¹¶å‘è®¿é—®**
```python
# ä½¿ç”¨æ–‡ä»¶é”
import fcntl

with open('file.txt', 'a') as f:
    fcntl.flock(f, fcntl.LOCK_EX)  # ç‹¬å é”
    f.write('data')
    fcntl.flock(f, fcntl.LOCK_UN)  # é‡Šæ”¾é”
```

**æ–‡ä»¶å·¥å…·çš„è®¾è®¡åŸåˆ™ï¼š**

**1. å®‰å…¨æ²™ç®±**
```
â€¢ é™åˆ¶è®¿é—®è·¯å¾„
â€¢ æ£€æŸ¥æ–‡ä»¶ç±»å‹
â€¢ é™åˆ¶æ–‡ä»¶å¤§å°
â€¢ ç¦æ­¢å±é™©æ“ä½œ
```

**2. å¥å£®æ€§**
```
â€¢ ç¼–ç å¤„ç†
â€¢ é”™è¯¯æ¢å¤
â€¢ èµ„æºæ¸…ç†
â€¢ è¶…æ—¶æ§åˆ¶
```

**3. æ˜“ç”¨æ€§**
```
â€¢ è‡ªåŠ¨è¯†åˆ«ç¼–ç 
â€¢ æ™ºèƒ½æ ¼å¼è½¬æ¢
â€¢ æ‰¹é‡æ“ä½œ
â€¢ è¿›åº¦åé¦ˆ
```

**4. æ€§èƒ½**
```
â€¢ æµå¼è¯»å–
â€¢ å¹¶è¡Œå¤„ç†
â€¢ å¢é‡æ›´æ–°
â€¢ ç¼“å­˜æœºåˆ¶
```

**ä»Šå¤©è¿™ä¸€è¯¾ï¼Œæˆ‘è¦å¸¦ä½ ï¼š**

**ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ–‡ä»¶æ“ä½œ**
- è¯»å–æ–‡ä»¶
- å†™å…¥æ–‡ä»¶
- å®‰å…¨æ£€æŸ¥

**ç¬¬äºŒéƒ¨åˆ†ï¼šç›®å½•æ“ä½œ**
- éå†ç›®å½•
- æ–‡ä»¶æœç´¢
- æ‰¹é‡å¤„ç†

**ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜çº§åŠŸèƒ½**
- æ–‡ä»¶ç›‘æ§
- æ ¼å¼è½¬æ¢
- å‹ç¼©è§£å‹

**ç¬¬å››éƒ¨åˆ†ï¼šå®‰å…¨æ²™ç®±**
- è·¯å¾„é™åˆ¶
- æƒé™æ§åˆ¶
- èµ„æºé™åˆ¶

**ç¬¬äº”éƒ¨åˆ†ï¼šå®Œæ•´å®æˆ˜**
- æ–‡ä»¶ç®¡ç†Agent
- æ™ºèƒ½åˆ†æ
- æœ€ä½³å®è·µ

å­¦å®Œè¿™ä¸€è¯¾ï¼Œä½ çš„Agentå°†èƒ½æ“ä½œæ–‡ä»¶ï¼

å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹ï¼"

---

### ğŸ’¡ æ ¸å¿ƒç†å¿µ

```
ã€æ–‡ä»¶ç³»ç»Ÿ = Agentçš„å·¥ä½œç©ºé—´ã€‘

æ²¡æœ‰æ–‡ä»¶æ“ä½œï¼š
â€¢ æ— æ³•æŒä¹…åŒ–
â€¢ æ— æ³•å¤„ç†æ–‡æ¡£
â€¢ æ— æ³•æ‰¹é‡æ“ä½œ

æœ‰äº†æ–‡ä»¶æ“ä½œï¼š
â€¢ è¯»å†™è‡ªå¦‚
â€¢ æ‰¹é‡å¤„ç†
â€¢ æ™ºèƒ½åˆ†æ

ã€å®‰å…¨æ²™ç®±æ˜¯å¿…éœ€çš„ã€‘

æ°¸è¿œè®°ä½ï¼š
â€¢ è·¯å¾„å¿…é¡»åœ¨ç™½åå•å†…
â€¢ æ–‡ä»¶å¤§å°å¿…é¡»é™åˆ¶
â€¢ å±é™©æ“ä½œå¿…é¡»ç¦æ­¢
```

---

## ğŸ“š ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ–‡ä»¶æ“ä½œ

### ä¸€ã€å®‰å…¨çš„æ–‡ä»¶è¯»å–å·¥å…·

```python
import os
from pathlib import Path
from typing import Optional, List
import chardet

class FileSecurityError(Exception):
    """æ–‡ä»¶å®‰å…¨é”™è¯¯"""
    pass

class FileReadTool:
    """æ–‡ä»¶è¯»å–å·¥å…·"""
    
    def __init__(self, base_directory: str = "."):
        self.name = "read_file"
        self.description = "è¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹ã€‚è¾“å…¥æ–‡ä»¶è·¯å¾„ã€‚"
        
        # å®‰å…¨é…ç½®
        self.base_dir = Path(base_directory).resolve()
        self.max_file_size = 10 * 1024 * 1024  # 10MB
        
        # å…è®¸çš„æ–‡ä»¶æ‰©å±•å
        self.allowed_extensions = [
            '.txt', '.md', '.py', '.js', '.json',
            '.csv', '.xml', '.html', '.css', '.log'
        ]
    
    def run(self, file_path: str) -> str:
        """
        è¯»å–æ–‡ä»¶
        
        Args:
            file_path: æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹æˆ–ç»å¯¹ï¼‰
        """
        try:
            # 1. å®‰å…¨æ£€æŸ¥
            safe_path = self._validate_path(file_path)
            
            # 2. æ£€æŸ¥æ–‡ä»¶å¤§å°
            self._check_file_size(safe_path)
            
            # 3. æ£€æŸ¥æ–‡ä»¶ç±»å‹
            self._check_file_extension(safe_path)
            
            # 4. è¯»å–æ–‡ä»¶
            content = self._read_file(safe_path)
            
            return f"æ–‡ä»¶å†…å®¹ï¼š\n\n{content}"
            
        except FileSecurityError as e:
            return f"å®‰å…¨é”™è¯¯ï¼š{str(e)}"
        except FileNotFoundError:
            return f"é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨ - {file_path}"
        except Exception as e:
            return f"é”™è¯¯ï¼š{str(e)}"
    
    def _validate_path(self, file_path: str) -> Path:
        """éªŒè¯å¹¶è§„èŒƒåŒ–è·¯å¾„"""
        
        # è½¬æ¢ä¸ºPathå¯¹è±¡
        path = Path(file_path)
        
        # å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼ŒåŸºäºbase_dirè§£æ
        if not path.is_absolute():
            path = self.base_dir / path
        
        # è§£æçœŸå®è·¯å¾„ï¼ˆå¤„ç†..ç­‰ï¼‰
        path = path.resolve()
        
        # æ£€æŸ¥æ˜¯å¦åœ¨base_dirå†…
        try:
            path.relative_to(self.base_dir)
        except ValueError:
            raise FileSecurityError(
                f"è·¯å¾„ä¸åœ¨å…è®¸çš„ç›®å½•å†…ï¼š{path}"
            )
        
        return path
    
    def _check_file_size(self, path: Path):
        """æ£€æŸ¥æ–‡ä»¶å¤§å°"""
        
        size = path.stat().st_size
        
        if size > self.max_file_size:
            size_mb = size / 1024 / 1024
            max_mb = self.max_file_size / 1024 / 1024
            raise FileSecurityError(
                f"æ–‡ä»¶è¿‡å¤§ï¼š{size_mb:.2f}MBï¼ˆæœ€å¤§{max_mb}MBï¼‰"
            )
    
    def _check_file_extension(self, path: Path):
        """æ£€æŸ¥æ–‡ä»¶æ‰©å±•å"""
        
        ext = path.suffix.lower()
        
        if ext not in self.allowed_extensions:
            raise FileSecurityError(
                f"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š{ext}"
            )
    
    def _read_file(self, path: Path) -> str:
        """è¯»å–æ–‡ä»¶å†…å®¹"""
        
        # è‡ªåŠ¨æ£€æµ‹ç¼–ç 
        with open(path, 'rb') as f:
            raw_data = f.read()
            result = chardet.detect(raw_data)
            encoding = result['encoding'] or 'utf-8'
        
        # ä½¿ç”¨æ£€æµ‹åˆ°çš„ç¼–ç è¯»å–
        try:
            content = raw_data.decode(encoding)
        except:
            # å¦‚æœè§£ç å¤±è´¥ï¼Œå°è¯•UTF-8
            content = raw_data.decode('utf-8', errors='ignore')
        
        return content
    
    def to_dict(self):
        """è½¬ä¸ºå·¥å…·å®šä¹‰"""
        return {
            "type": "function",
            "function": {
                "name": self.name,
                "description": self.description,
                "parameters": {
                    "type": "object",
                    "properties": {
                        "file_path": {
                            "type": "string",
                            "description": "æ–‡ä»¶è·¯å¾„ï¼Œå¦‚'data.txt'æˆ–'logs/app.log'"
                        }
                    },
                    "required": ["file_path"]
                }
            }
        }

# æ¼”ç¤º
def demo_file_read_tool():
    """æ¼”ç¤ºæ–‡ä»¶è¯»å–å·¥å…·"""
    
    # åˆ›å»ºæµ‹è¯•ç›®å½•å’Œæ–‡ä»¶
    os.makedirs("test_workspace", exist_ok=True)
    
    with open("test_workspace/sample.txt", "w", encoding="utf-8") as f:
        f.write("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶\nåŒ…å«å¤šè¡Œå†…å®¹\nç”¨äºæ¼”ç¤ºæ–‡ä»¶è¯»å–")
    
    # åˆ›å»ºå·¥å…·
    tool = FileReadTool("test_workspace")
    
    print("="*60)
    print("æ–‡ä»¶è¯»å–å·¥å…·æ¼”ç¤º")
    print("="*60)
    
    # æµ‹è¯•æ­£å¸¸è¯»å–
    print("\n1. è¯»å–æ–‡ä»¶")
    result = tool.run("sample.txt")
    print(result)
    
    # æµ‹è¯•ä¸å­˜åœ¨çš„æ–‡ä»¶
    print("\n2. è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶")
    result = tool.run("nonexistent.txt")
    print(result)
    
    # æµ‹è¯•è·¯å¾„è¶Šç•Œ
    print("\n3. æµ‹è¯•è·¯å¾„è¶Šç•Œ")
    result = tool.run("../../../etc/passwd")
    print(result)

demo_file_read_tool()
```

---

## ğŸ’» ç¬¬äºŒéƒ¨åˆ†ï¼šæ–‡ä»¶å†™å…¥å·¥å…·

### ä¸€ã€å®‰å…¨çš„æ–‡ä»¶å†™å…¥

```python
class FileWriteTool:
    """æ–‡ä»¶å†™å…¥å·¥å…·"""
    
    def __init__(self, base_directory: str = "."):
        self.name = "write_file"
        self.description = "å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ã€‚å¯ä»¥åˆ›å»ºæ–°æ–‡ä»¶æˆ–è¦†ç›–ç°æœ‰æ–‡ä»¶ã€‚"
        
        self.base_dir = Path(base_directory).resolve()
        self.max_content_size = 5 * 1024 * 1024  # 5MB
        
        # å…è®¸å†™å…¥çš„æ‰©å±•å
        self.allowed_extensions = [
            '.txt', '.md', '.json', '.csv', '.log'
        ]
    
    def run(
        self,
        file_path: str,
        content: str,
        mode: str = "write"
    ) -> str:
        """
        å†™å…¥æ–‡ä»¶
        
        Args:
            file_path: æ–‡ä»¶è·¯å¾„
            content: è¦å†™å…¥çš„å†…å®¹
            mode: å†™å…¥æ¨¡å¼ï¼ˆwrite=è¦†ç›–ï¼Œappend=è¿½åŠ ï¼‰
        """
        try:
            # 1. å®‰å…¨æ£€æŸ¥
            safe_path = self._validate_path(file_path)
            
            # 2. æ£€æŸ¥å†…å®¹å¤§å°
            if len(content) > self.max_content_size:
                raise FileSecurityError("å†…å®¹è¿‡å¤§")
            
            # 3. æ£€æŸ¥æ–‡ä»¶ç±»å‹
            self._check_file_extension(safe_path)
            
            # 4. åˆ›å»ºçˆ¶ç›®å½•
            safe_path.parent.mkdir(parents=True, exist_ok=True)
            
            # 5. å†™å…¥æ–‡ä»¶
            write_mode = 'a' if mode == 'append' else 'w'
            with open(safe_path, write_mode, encoding='utf-8') as f:
                f.write(content)
            
            return f"æˆåŠŸå†™å…¥æ–‡ä»¶ï¼š{file_path}"
            
        except FileSecurityError as e:
            return f"å®‰å…¨é”™è¯¯ï¼š{str(e)}"
        except Exception as e:
            return f"é”™è¯¯ï¼š{str(e)}"
    
    def _validate_path(self, file_path: str) -> Path:
        """éªŒè¯è·¯å¾„"""
        path = Path(file_path)
        if not path.is_absolute():
            path = self.base_dir / path
        path = path.resolve()
        
        try:
            path.relative_to(self.base_dir)
        except ValueError:
            raise FileSecurityError("è·¯å¾„ä¸åœ¨å…è®¸çš„ç›®å½•å†…")
        
        return path
    
    def _check_file_extension(self, path: Path):
        """æ£€æŸ¥æ–‡ä»¶æ‰©å±•å"""
        ext = path.suffix.lower()
        if ext not in self.allowed_extensions:
            raise FileSecurityError(f"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š{ext}")
    
    def to_dict(self):
        """è½¬ä¸ºå·¥å…·å®šä¹‰"""
        return {
            "type": "function",
            "function": {
                "name": self.name,
                "description": self.description,
                "parameters": {
                    "type": "object",
                    "properties": {
                        "file_path": {
                            "type": "string",
                            "description": "æ–‡ä»¶è·¯å¾„"
                        },
                        "content": {
                            "type": "string",
                            "description": "è¦å†™å…¥çš„å†…å®¹"
                        },
                        "mode": {
                            "type": "string",
                            "enum": ["write", "append"],
                            "description": "å†™å…¥æ¨¡å¼ï¼šwrite=è¦†ç›–ï¼Œappend=è¿½åŠ "
                        }
                    },
                    "required": ["file_path", "content"]
                }
            }
        }
```

---

## ğŸ¯ ç¬¬ä¸‰éƒ¨åˆ†ï¼šç›®å½•æ“ä½œå·¥å…·

### ä¸€ã€ç›®å½•éå†å’Œæœç´¢

```python
import fnmatch

class DirectoryTool:
    """ç›®å½•æ“ä½œå·¥å…·"""
    
    def __init__(self, base_directory: str = "."):
        self.name = "list_directory"
        self.description = "åˆ—å‡ºç›®å½•å†…å®¹ï¼Œæ”¯æŒæœç´¢å’Œè¿‡æ»¤"
        
        self.base_dir = Path(base_directory).resolve()
        self.max_depth = 5  # æœ€å¤§é€’å½’æ·±åº¦
    
    def run(
        self,
        directory: str = ".",
        pattern: Optional[str] = None,
        recursive: bool = False
    ) -> str:
        """
        åˆ—å‡ºç›®å½•
        
        Args:
            directory: ç›®å½•è·¯å¾„
            pattern: æ–‡ä»¶åæ¨¡å¼ï¼Œå¦‚"*.txt"
            recursive: æ˜¯å¦é€’å½’
        """
        try:
            # éªŒè¯è·¯å¾„
            safe_path = self._validate_path(directory)
            
            if not safe_path.is_dir():
                return f"é”™è¯¯ï¼šä¸æ˜¯ç›®å½• - {directory}"
            
            # åˆ—å‡ºæ–‡ä»¶
            files = self._list_files(safe_path, pattern, recursive)
            
            if not files:
                return "ç›®å½•ä¸ºç©º"
            
            # æ ¼å¼åŒ–è¾“å‡º
            result = self._format_file_list(files, safe_path)
            
            return result
            
        except Exception as e:
            return f"é”™è¯¯ï¼š{str(e)}"
    
    def _validate_path(self, directory: str) -> Path:
        """éªŒè¯è·¯å¾„"""
        path = Path(directory)
        if not path.is_absolute():
            path = self.base_dir / path
        path = path.resolve()
        
        try:
            path.relative_to(self.base_dir)
        except ValueError:
            raise FileSecurityError("è·¯å¾„ä¸åœ¨å…è®¸çš„ç›®å½•å†…")
        
        return path
    
    def _list_files(
        self,
        path: Path,
        pattern: Optional[str],
        recursive: bool,
        depth: int = 0
    ) -> List[Path]:
        """åˆ—å‡ºæ–‡ä»¶"""
        
        if depth > self.max_depth:
            return []
        
        files = []
        
        try:
            for item in path.iterdir():
                # è·³è¿‡éšè—æ–‡ä»¶
                if item.name.startswith('.'):
                    continue
                
                if item.is_file():
                    # æ£€æŸ¥æ¨¡å¼åŒ¹é…
                    if pattern is None or fnmatch.fnmatch(item.name, pattern):
                        files.append(item)
                
                elif item.is_dir() and recursive:
                    # é€’å½’å­ç›®å½•
                    files.extend(
                        self._list_files(item, pattern, recursive, depth + 1)
                    )
        except PermissionError:
            pass
        
        return files
    
    def _format_file_list(self, files: List[Path], base: Path) -> str:
        """æ ¼å¼åŒ–æ–‡ä»¶åˆ—è¡¨"""
        
        lines = [f"æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶ï¼š\n"]
        
        for file in sorted(files):
            # è·å–ç›¸å¯¹è·¯å¾„
            try:
                rel_path = file.relative_to(base)
            except:
                rel_path = file
            
            # è·å–æ–‡ä»¶å¤§å°
            size = file.stat().st_size
            size_str = self._format_size(size)
            
            lines.append(f"  {rel_path} ({size_str})")
        
        return "\n".join(lines)
    
    def _format_size(self, size: int) -> str:
        """æ ¼å¼åŒ–æ–‡ä»¶å¤§å°"""
        for unit in ['B', 'KB', 'MB', 'GB']:
            if size < 1024:
                return f"{size:.1f}{unit}"
            size /= 1024
        return f"{size:.1f}TB"
    
    def to_dict(self):
        """è½¬ä¸ºå·¥å…·å®šä¹‰"""
        return {
            "type": "function",
            "function": {
                "name": self.name,
                "description": self.description,
                "parameters": {
                    "type": "object",
                    "properties": {
                        "directory": {
                            "type": "string",
                            "description": "ç›®å½•è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•"
                        },
                        "pattern": {
                            "type": "string",
                            "description": "æ–‡ä»¶åæ¨¡å¼ï¼Œå¦‚'*.txt'ã€'data*.json'"
                        },
                        "recursive": {
                            "type": "boolean",
                            "description": "æ˜¯å¦é€’å½’æœç´¢å­ç›®å½•"
                        }
                    }
                }
            }
        }
```

---

## âš¡ ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿå·¥å…·é›†

### ä¸€ã€é›†æˆå·¥å…·ç®¡ç†å™¨

```python
class FileSystemToolkit:
    """æ–‡ä»¶ç³»ç»Ÿå·¥å…·é›†"""
    
    def __init__(self, workspace: str = "./workspace"):
        """åˆå§‹åŒ–å·¥å…·é›†"""
        
        # åˆ›å»ºå·¥ä½œç©ºé—´
        self.workspace = Path(workspace).resolve()
        self.workspace.mkdir(parents=True, exist_ok=True)
        
        # åˆå§‹åŒ–å„ä¸ªå·¥å…·
        self.read_tool = FileReadTool(str(self.workspace))
        self.write_tool = FileWriteTool(str(self.workspace))
        self.dir_tool = DirectoryTool(str(self.workspace))
        
        # å·¥å…·æ˜ å°„
        self.tools = {
            "read_file": self.read_tool,
            "write_file": self.write_tool,
            "list_directory": self.dir_tool
        }
    
    def get_tools(self) -> List:
        """è·å–æ‰€æœ‰å·¥å…·"""
        return list(self.tools.values())
    
    def execute(self, tool_name: str, **kwargs) -> str:
        """æ‰§è¡Œå·¥å…·"""
        
        if tool_name not in self.tools:
            return f"é”™è¯¯ï¼šå·¥å…·ä¸å­˜åœ¨ - {tool_name}"
        
        tool = self.tools[tool_name]
        return tool.run(**kwargs)

# æ¼”ç¤º
def demo_file_system_toolkit():
    """æ¼”ç¤ºæ–‡ä»¶ç³»ç»Ÿå·¥å…·é›†"""
    
    toolkit = FileSystemToolkit("./demo_workspace")
    
    print("="*60)
    print("æ–‡ä»¶ç³»ç»Ÿå·¥å…·é›†æ¼”ç¤º")
    print("="*60)
    
    # 1. å†™å…¥æ–‡ä»¶
    print("\n1. åˆ›å»ºæ–‡ä»¶")
    result = toolkit.execute(
        "write_file",
        file_path="notes.txt",
        content="è¿™æ˜¯ç¬¬ä¸€è¡Œ\nè¿™æ˜¯ç¬¬äºŒè¡Œ"
    )
    print(result)
    
    # 2. è¿½åŠ å†…å®¹
    print("\n2. è¿½åŠ å†…å®¹")
    result = toolkit.execute(
        "write_file",
        file_path="notes.txt",
        content="\nè¿™æ˜¯è¿½åŠ çš„å†…å®¹",
        mode="append"
    )
    print(result)
    
    # 3. è¯»å–æ–‡ä»¶
    print("\n3. è¯»å–æ–‡ä»¶")
    result = toolkit.execute(
        "read_file",
        file_path="notes.txt"
    )
    print(result)
    
    # 4. åˆ—å‡ºç›®å½•
    print("\n4. åˆ—å‡ºç›®å½•")
    result = toolkit.execute(
        "list_directory",
        directory="."
    )
    print(result)

demo_file_system_toolkit()
```

---

## ğŸ“ è¯¾åç»ƒä¹ 

### ç»ƒä¹ 1ï¼šæ–‡ä»¶ç›‘æ§
å®ç°æ–‡ä»¶å˜åŒ–ç›‘æ§å·¥å…·

### ç»ƒä¹ 2ï¼šæ‰¹é‡å¤„ç†
å®ç°æ‰¹é‡æ–‡ä»¶è½¬æ¢å·¥å…·

### ç»ƒä¹ 3ï¼šæ–‡ä»¶åˆ†æ
å®ç°æ–‡ä»¶å†…å®¹åˆ†æå·¥å…·

---

## ğŸ“ çŸ¥è¯†æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å®‰å…¨æ²™ç®±**
   - è·¯å¾„éªŒè¯
   - å¤§å°é™åˆ¶
   - ç±»å‹æ£€æŸ¥
   - æƒé™æ§åˆ¶

2. **æ–‡ä»¶æ“ä½œ**
   - è¯»å–æ–‡ä»¶
   - å†™å…¥æ–‡ä»¶
   - ç›®å½•éå†
   - æ‰¹é‡å¤„ç†

3. **å¥å£®æ€§**
   - ç¼–ç æ£€æµ‹
   - é”™è¯¯å¤„ç†
   - èµ„æºæ¸…ç†
   - è¶…æ—¶æ§åˆ¶

4. **æ˜“ç”¨æ€§**
   - ç®€å•æ¥å£
   - æ™ºèƒ½è¯†åˆ«
   - å‹å¥½æç¤º

---

## ğŸš€ ä¸‹èŠ‚é¢„å‘Š

ä¸‹ä¸€è¯¾ï¼š**ç¬¬82è¯¾ï¼šå®æˆ˜-å¤šå·¥å…·Agentæ™ºèƒ½åŠ©æ‰‹**

- é›†æˆæ‰€æœ‰å·¥å…·
- å¤æ‚ä»»åŠ¡å¤„ç†
- æ™ºèƒ½å†³ç­–
- å®Œæ•´é¡¹ç›®

**æ‰“é€ å…¨èƒ½Agentï¼** ğŸ¤–

---

**ğŸ’ª è®°ä½ï¼šæ–‡ä»¶æ“ä½œè®©Agentæ›´å®ç”¨ï¼Œå®‰å…¨æ²™ç®±ä¸å¯å°‘ï¼**

**ä¸‹ä¸€è¯¾è§ï¼** ğŸ‰
